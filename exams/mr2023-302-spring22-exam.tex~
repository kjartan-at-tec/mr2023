\documentclass[letterpaper,12pt]{scrartcl}
\usepackage{epsfig,latexsym,amsmath,amssymb,epic,eepic,psfrag,subfigure,float,euscript,array}
\usepackage[latin1]{inputenc}
\usepackage[margin=24mm]{geometry}
\usepackage{tikz,pgf,pgfplots}
\usepgfplotslibrary{fillbetween}
\usepgfplotslibrary{groupplots}
\usetikzlibrary{decorations, arrows, fit, circuits.plc.ladder}

\usepackage[amssymb]{SIunits}

\newenvironment{exercise}[1][Exercise]{\begin{trivlist} \item[\hskip
    \labelsep {\stepcounter{exerctr}\bfseries #1
      \arabic{exerctr}}]}{\end{trivlist}\vspace{10mm}}

\newcounter{exerctr}
\newcounter{abcctr}[exerctr]

\newcommand{\abc}{\noindent\vspace{1mm}\\ \textbf{
    \stepcounter{abcctr}(\alph{abcctr})\ }}
\newcommand{\bbm}{\begin{bmatrix}}
\newcommand{\ebm}{\end{bmatrix}}
\newcommand{\point}[1]{\hfill \textbf{ (#1p)}\\ \vspace{-5mm}}
\newcommand{\ctrb}{\EuScript{S}}
\newcommand{\Lap}{\mathcal{L}}
\newcommand{\obsv}{\EuScript{O}}
\newcommand{\realdel}{\text{Re}}
\newcommand{\imagdel}{\text{Im}}
\newcommand{\bC}{\mathbb{C}}
\newcommand{\bR}{\mathbb{R}}
\newcommand{\bmpv}{\begin{minipage}[t]}
\newcommand{\bmps}{\begin{minipage}[t]{45mm}}
\newcommand{\bmpm}{\begin{minipage}[t]{90mm}}
\newcommand{\bmpl}{\begin{minipage}[t]{\textwidth}}
\newcommand{\emp}{\end{minipage}}
\newcommand{\mexp}[1]{\ensuremath{\mathrm{e}^{#1}}}

\newcommand{\AxisRotator}[1][rotate=0]{%
    \tikz [x=0.2cm,y=0.60cm,line width=.1ex,-stealth,#1] \draw (0,0) arc (-150:150:1 and 1);%
}

%\addtolength{\topmargin}{-1cm}
%\textheight 22.5cm
%\oddsidemargin 1.3cm
%\evensidemargin 1.3cm

\makeatletter
\newcommand*{\rom}[1]{\expandafter\@slowromancap\romannumeral #1@}
\makeatother

\newcommand*\circled[1]{\tikz[baseline=(char.base)]{
            \node[shape=circle,draw,inner sep=2pt] (char) {#1};}}


\title{Modeling and automation - Exam group 302}
\author{Kjartan Halvorsen}
\date{2022-06-09}

\begin{document}

\maketitle


\begin{description}
\item[Time] 11:05 - 12:55
\item[Permitted aids] The single page with your own notes, table of Laplace transforms, calculator
\end{description}

All answers should be readable and well motivated (if nothing else is written). Solutions/motivations should be written on the provided spaces in this exam. Use the last page if more space is needed.

\begin{center}
{\Large Good luck!} \\
\end{center}

\noindent
\fbox{
\bmpl
\textbf{ Matricula and name:}\\
\vspace*{14mm}
\emp}


%\clearpage

%-----------------------------------------------------------------

\section*{Magnetic levitation}
\label{sec-1}

Figure \ref{fig:magnetic-suspension} shows a one-dimensional magnetic suspension system. The current $i$ in the windings generates a magnetic field which suspends the mass $m$. Friction is completely negligable, since the mass is not in contact with any other body, and its velocity is typically very small (no air-drag). Hence, there are two forces acting on the mass: gravity and the magnetic force. The magnetic force is proportional to the square of the current $i$ and inverse proportional to the square of the gap distance $x$. This gives the equation of motion 
\begin{equation}
m \ddot{x} = -C \left( \frac{i}{x} \right)^2 + mg.
\label{eq:magode}
\end{equation}

\begin{figure}[htb]
\begin{center}
\includegraphics[width=0.5\linewidth]{../figures/magnetic-suspension}
\caption{A magnetic suspension system. The force of gravity acts to pull the mass $m$ downwards. The force due to the magnetic field generated by the current $i$ keeps the mass from falling down. }
\label{fig:magnetic-suspension} 
\end{center}
\end{figure}
The system is non-linear, so in order to use linear control design, the system must be linearized about an operating point. Introduce the deviation variables \(y\) and \(u\)
\begin{align*}
x(t) &= x_0 + y(t) \\
i(t) &= i_0 - u(t).
\end{align*}
The input signal to the system is the change, $u$, in the current in the windings, and the output signal is the change, \(y\),  in the gap distance. The negative sign in the definition of the deviation variable $u$,  \(i = i_0 - u\) is introduced so that a positive input signal leads to a positive change in the gap distance.
\begin{center}
\begin{tikzpicture}[node distance=20mm,
                    block/.style={rectangle, draw, minimum width=15mm, inner sep=3mm},
                    sumnode/.style={circle, draw, inner sep=3pt}]
  \node[coordinate] (input) {};
   \node[block, right of=input,] (lti) {$G(s)$};
   \node[coordinate, right of=lti,] (output) {};
   \draw[->] (input) -- node[near start, above] {$u(t)$}  (lti);
   \draw[->] (lti) -- node[coordinate] (meas) {} node[near end, above] {$y(t)$} (output);
 \end{tikzpicture}
\end{center}


\begin{exercise}
\abc
Show that given an operating point $x_0$, the corresponding operating point current that gives equilibrium is
\[ i_0 = x_0\sqrt{\frac{mg}{C}}.\]

\noindent
\fbox{
\bmpl
\textbf{ Calculations:}\\
\vspace*{40mm}
\emp}



\abc
Show that the linearized model of the magnetic levitator system becomes
\begin{equation}
\ddot{y} = \frac{2g}{x_0} y + \frac{2 \sqrt{Cg}}{\sqrt{m} x_0} u
\label{eq:linearode}
\end{equation}

\noindent
\fbox{
\bmpl
\textbf{ Calculations:}\\
\vspace*{80mm}
\emp}

\abc
Determine the transfer function of the linear model \eqref{eq:linearode}.

\noindent
\fbox{
\bmpl
\textbf{ Calculations:}\\
\vspace*{60mm}
\emp}


\abc
[Bonus exercise worth 5p] Find the poles of the system and determine if the system is stable or not.

\noindent
\fbox{
\bmpl
\textbf{ Calculations:}\\
\vspace*{50mm}
\emp}
\end{exercise}



%\begin{equation}
%G(s) = \frac{ \frac{ 2\sqrt{Cg} }{\sqrt{m} x_0} }{s^2 - \frac{2g}{x_0}}.
%\end{equation}
%The system is unstable, with poles in \(\pm \sqrt{\frac{2g}{x_0}}\). Normalizing the time (using the unit of time \(T=\sqrt{\frac{x_0}{2g}}\)) and setting $u(t) = \frac{2\sqrt{Cg}}{\sqrt{m}x_0} \tilde{i}(t)$ gives the plant model
%\begin{equation}
%Y(s) = G(s)U(s) = \frac{1}{s^2 - 1} U(s).
%\label{eq:trf}
%\end{equation}



\section*{A Coupled spring-mass system}
The figure below shows a system consisting of two masses connected together and to two rigid walls.
\begin{center}
  \includegraphics[width=0.75\linewidth]{../figures/two-masses-spring-damper-1}
\end{center}
The displacements $z_1$ and $z_2$ are deviations from the equilibrium positions of the two masses, respectively, when the force $F(t)$ acting on the right mass is zero. The springs and dampers are considered to be linear. 

\subsection*{Problems}
\begin{exercise}
\abc
Draw free-body-diagrmas and determine the differential equations that describe the system.

\noindent
\fbox{
\bmpl
\textbf{ Calculations:}\\
\vspace*{80mm}
\emp}

\abc
Choose a suitable state vector $x$, and write the system on state-space form
\begin{align*}
  \dot{x}(t) &= Ax(t) + B\,F(t)\\
  y(t) &= C x(t)
\end{align*}
where the output signal consists of the positions of the two masses, $y=\bbm z_1\\z_2\ebm$.

\noindent
\fbox{
\bmpl
\textbf{ Calculations:}\\
\vspace*{90mm}
\emp}

\end{exercise}



\cleardoublepage
\end{document}
\section*{Solutions}
\setcounter{exerctr}{0} 

\subsection*{Magnetic levitation}
\begin{exercise}


  Taking the Laplace transform of each term in the model \eqref{eq:ode}, and setting all initial values to zero (we are interested in the transfer function, not the transient response to the initial value) gives
\[ s^2 Y(s) = -aY(s) + bU(s) + csV(s),\]
which solved for $Y(s)$ is
\[ Y(s) = \frac{b}{s^2 + a} U(s) + \frac{cs}{s^2 + a} V(s).\]
Hence \[G_d(s) = \frac{cs}{s^2 + a}.\]
\end{exercise}


\subsection*{Spring-mass system}

\begin{exercise}
  \abc
  Free-body-diagrams of the two bodies gives
  \begin{center}
    \begin{tikzpicture}
      \node[draw, minimum height=14mm, minimum width=14mm] (m1) {M};
      \draw[->] (m1.west) -- ++(-14mm, 0) node[below] {$F_{s_1}$};
      \draw[<-] (m1.north west) -- ++(-14mm, 0) node[above] {$F$};
      \draw[<-] (m1.east) -- ++(14mm, 0) node[above] {$F_{s_2}$};

      \begin{scope}[xshift = 6cm]
      \node[draw, minimum height=14mm, minimum width=14mm] (m2) {M};
      \draw[<-] (m2.west) -- ++(-14mm, 0) node[above] {$F_{s_2}$};
      \draw[<-] (m2.east) -- ++(14mm, 0) node[above] {$F_{d}$};
      \end{scope}
    \end{tikzpicture}
  \end{center}
  where the spring forces are given by
  \[ F_{s_1} = kx_1, \qquad F_{s_2} = k(x_1-x_2), \]
  and the damper force
  \[ F_d = b \dot{x}_2\]
  Newton's second law for each body gives
  \begin{align*}
    M\ddot{x}_1 &= F - F_{s_1} - F_{s_2} = F - kx_1 - k(x_1-x_2)\\
    M\ddot{x}_2 &=   F_{s_2} -F_d = k(x_1-x_2) - b\dot{x}_2.
  \end{align*}

  \abc
  One choice of state vector is
  \[ z = \bbm x_1\\ \dot{x}_1 \\x_1-x_2 \\dot{x}_2 \ebm, \]
  with which the differential equations can be written
  \begin{align*}
    \dot{z}_1 &= \dot{x}_1 = z_2\\
    \dot{z}_2 &= \ddot{x}_1 = -\frac{k}{M} x_1 - \frac{k}{M}(x_1-x_2) + \frac{1}{M} F = -\frac{k}{M}z_1  -\frac{k}{M}z_3  + \frac{1}{M} F\\
    \dot{z}_3 &= \dot{x}_1 - \dot{x}_2 = z_2 - z_ 4\\
    \dot{z}_4 &= \ddot{x}_2 = \frac{k}{M}(x_1 - x_2) - \frac{b}{M}\dot{x}_2 = \frac{k}{M}z_3 - \frac{b}{M}z_4. 
  \end{align*}
  The state-space model becomes
  \begin{align*}
    \dot{z} &= \bbm 0 & 1 & 0 & 0\\ -\frac{k}{M} & 0 & -\frac{k}{M} & 0 \\ 0 & 1 & 0 & -1\\ 0 & 0 & \frac{k}{M} & -\frac{b}{M} \ebm z + \bbm 0\\\frac{1}{M}\\0\\0\ebm\\
    y &= x_2 = \bbm 1 & 0 & -1 & 0\ebm z.
  \end{align*}

  \abc
  In equilibrium with a constant force $F(t)=F_0$, the masses will be shifted to the right a distance $x_1=x_2=x_0$. For the left-most mass, we get that, since $\ddot{x}_1 = 0$ and the forces are in balance,
  \[ 0 = F_0 -F_s = F_0 - kx_0^3.\]
  Solving for $x_0$ gives
  \[ x_0 = \left(\frac{F_0}{k}\right)^\frac{1}{3}. \]

  \abc
  The Taylor-expansion of $F_s(x_1) = kx_1^3$ about the point $x_0$ is given by
  \[ F_s(x_1) = F_s(x_0) + 3kx_0^2 (x_1-x_0) + \frac{6kx_0}{2!}(x_1-x_0)^2 + \frac{6k}{3!}(x_1-x_0)^3,\]
  so the linear model becomes
  \[ F_s(x_1) \approx F_s(x_0) + 3kx_0^2(x_1-x_0) = F_0 + 3kx_0^2 w\]
  \[ F_s - F_0 = 3kx_0^2 w\]
  \[ v = 3kx_0^2 w.\]
  The parameter we are looking for is
  \[ a = 3kx_0^2 = 3k\left(\big(\frac{F_0}{k}\big)^\frac{1}{3}\right)^2 = 3k\big(\frac{F_0}{k}\big)^\frac{2}{3} =  3k^\frac{1}{3}F_0^\frac{2}{3}. \]
  
\end{exercise}
\end{document}
